<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Synth Engine Sim</title>
  <style>
    body {
      background: #111;
      color: #0f0;
      font-family: monospace;
      text-align: center;
      padding: 2em;
    }
    input, select, button {
      font-size: 1em;
      padding: 0.5em;
      margin: 0.5em;
    }
  </style>
</head>
<body>
  <h1>Synthetic Engine Simulator</h1>

  <div>
    <label>Engine Type:</label>
    <select id="engineType">
      <option value="v8">V8</option>
      <option value="inline6">Inline-6</option>
      <option value="rotary">Rotary</option>
      <option value="bike">Motorcycle</option>
    </select>
  </div>

  <div>
    <label>RPM:</label>
    <input type="range" id="rpmSlider" min="800" max="9000" value="1000" />
    <span id="rpmDisplay">1000</span> RPM
  </div>

  <div>
    <label>Displacement (L):</label>
    <input type="range" id="dispSlider" min="0.8" max="8.0" step="0.1" value="2.0" />
    <span id="dispDisplay">2.0</span>L
  </div>

  <div>
    <label><input type="checkbox" id="turboToggle" /> Turbo</label>
    <label><input type="checkbox" id="cammedToggle" /> Cammed Idle</label>
  </div>

  <div>
    <button onclick="startEngine()">Start Engine</button>
    <button onclick="stopEngine()">Stop</button>
  </div>

  <script>
    const AudioContext = window.AudioContext || window.webkitAudioContext;
    const ctx = new AudioContext();

    let osc, gainNode, turboOsc, camLFO;
    let running = false;

    const rpmSlider = document.getElementById('rpmSlider');
    const rpmDisplay = document.getElementById('rpmDisplay');
    const dispSlider = document.getElementById('dispSlider');
    const dispDisplay = document.getElementById('dispDisplay');

    rpmSlider.oninput = () => rpmDisplay.textContent = rpmSlider.value;
    dispSlider.oninput = () => dispDisplay.textContent = dispSlider.value;

    function startEngine() {
      if (running) return;
      running = true;

      const engineType = document.getElementById('engineType').value;
      const rpm = parseFloat(rpmSlider.value);
      const disp = parseFloat(dispSlider.value);
      const turbo = document.getElementById('turboToggle').checked;
      const cammed = document.getElementById('cammedToggle').checked;

      const cylinders = engineType === 'v8' ? 8 :
                        engineType === 'inline6' ? 6 :
                        engineType === 'rotary' ? 2 :
                        1;

      const firingRate = (rpm / 60) * (cylinders / 2);

      // Setup gain
      gainNode = ctx.createGain();
      gainNode.gain.value = Math.min(1, disp / 4);
      
      // Setup oscillator
      osc = ctx.createOscillator();
      osc.type = engineType === 'v8' ? 'square' :
                 engineType === 'inline6' ? 'sawtooth' :
                 engineType === 'rotary' ? 'triangle' : 'sine';

      osc.frequency.setValueAtTime(firingRate, ctx.currentTime);
      osc.connect(gainNode);

      // Cammed idle?
      if (cammed) {
        camLFO = ctx.createOscillator();
        const lfoGain = ctx.createGain();
        camLFO.type = 'triangle';
        camLFO.frequency.setValueAtTime(1.5, ctx.currentTime);
        lfoGain.gain.value = 0.3;
        camLFO.connect(lfoGain);
        lfoGain.connect(gainNode.gain);
        camLFO.start();
      }

      // Turbo whistle
      if (turbo) {
        turboOsc = ctx.createOscillator();
        const tGain = ctx.createGain();
        turboOsc.type = 'sine';
        turboOsc.frequency.setValueAtTime(1000 + rpm / 10, ctx.currentTime);
        tGain.gain.value = 0.08 + (rpm / 10000);
        turboOsc.connect(tGain);
        tGain.connect(ctx.destination);
        turboOsc.start();
      }

      // Connect to output
      gainNode.connect(ctx.destination);
      osc.start();
    }

    function stopEngine() {
      running = false;
      try {
        osc?.stop();
        turboOsc?.stop();
        camLFO?.stop();
      } catch (e) {}
    }
  </script>
</body>
</html>